///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////

#include "ijo.h"

///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////

#define MAX_FRAMES 32

uint64_t frame_counter = 0;
uint32_t frame_index = 0;
float frame_delta_times[MAX_FRAMES] = {0};
bool frames_valid = false;

///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////

void fps_system (ecs_iter_t *it)
{
    frame_counter += 1;
    float dt = it->delta_time;

    frame_delta_times[frame_index] = dt;
    frame_index = frame_index + 1;
    if (frame_index >= MAX_FRAMES)
    {
        frame_index = 0;
        frames_valid = true;
    }

    printf ("fps system %f %f\n", dt, 1/dt);
}

///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////

void draw_frame_counter (void)
{
    char buffer[100];

    if (frames_valid)
    {
        float sum = 0;
        for (int i = 0; i < MAX_FRAMES; i ++)
        {
            sum += frame_delta_times[i];
        }
        sum /= MAX_FRAMES;

        snprintf (buffer, sizeof (buffer), "%ld", frame_counter);
        DrawTextEx (main_font, buffer, (Vector2) {4, 4}, 30, 0, (Color) {0, 0, 0, 255});
        snprintf (buffer, sizeof (buffer), "%7.1f ms", sum * 1000);
        DrawTextEx (main_font, buffer, (Vector2) {34, 4}, 30, 0, (Color) {0, 0, 0, 255});
        snprintf (buffer, sizeof (buffer), "%.1f Hz", 1 / sum);
        DrawTextEx (main_font, buffer, (Vector2) {174, 4}, 30, 0, (Color) {0, 0, 0, 255});
    }
}

///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
