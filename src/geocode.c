///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////

#include "ijo.h"

///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////

ecs_entity_t geocodes[128*1024/512][128*1024/512] = {0};

///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////

void init_geocodes (void)
{
    char buffer[100];

    for (int x = 0; x < 128*1024/512; x ++)
    {
        for (int y = 0; y < 128*1024/512; y ++)
        {
            snprintf (buffer, sizeof (buffer), "Geo(%d:%d)", x, y);
            geocodes[x][y] = ecs_new_id (world);
            ecs_set_name (world, geocodes[x][y], buffer);
        }
    }
}

///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////

ecs_entity_t get_geocode (float x, float y)
{
    int ix = (int) x;
    int iy = (int) y;

    int gx = ix / 256;
    int gy = iy / 256;

    if (gx < 0) { gx = 0; }
    if (gy < 0) { gy = 0; }
    if (gx > 128*1024/256) { gx = 128*1024/256-1; }
    if (gy > 128*1024/256) { gy = 128*1024/256-1; }

    return geocodes[gx][gy];
}

///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////
